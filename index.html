<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ìœ¨ NOW - ì¸í„°ë™í‹°ë¸Œ ë¦¬í¬íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto+Sans+KR', sans-serif;
            background-color: #faf9f6; 
            color: #2d2d2d;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .keypad-button {
            transition: all 0.1s ease;
            user-select: none;
        }
        
        .keypad-button:active {
            transform: scale(0.95);
            background-color: #e5e7eb;
        }

        .currency-row {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .currency-row.active {
            background-color: #ffffff;
            border-color: #2563eb;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        .nav-tab.active {
            color: #2563eb;
            border-bottom: 2px solid #2563eb;
        }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }

        .expression-display {
            font-size: 0.75rem;
            color: #9ca3af;
            height: 1rem;
        }

        .dynamic-text {
            word-break: break-all;
            line-height: 1.2;
        }
    </style>
</head>
<body class="antialiased">

    <!-- ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡° ê³„íš: 
        1. ë„¤ë¹„ê²Œì´ì…˜: PHP, USD, THB, VND íƒ­ ë©”ë‰´.
        2. ëŒ€ì‹œë³´ë“œ: "êµì°¨í™˜ìœ¨" ê°œë…ì„ ì ìš©í•œ ì–‘ë°©í–¥ ê³„ì‚°ê¸°.
        3. ì‹¤ì‹œê°„ ë¡œì§: ê¸€ë¡œë²Œ ë°ì´í„°ë¥¼ VND 100ë‹¨ìœ„ ê¸°ì¤€ìœ¼ë¡œ ì •ê·œí™”í•˜ì—¬ ì²˜ë¦¬.
        4. ì •ë³´ ì•„í‚¤í…ì²˜: ê³ ì •ëœ ì•ˆë‚´ ë¬¸êµ¬ë¥¼ ìœ ì§€í•˜ë©° í™˜ìœ¨ ë° ì°¨íŠ¸ ì •ë³´ë¥¼ íƒìƒ‰ ê°€ëŠ¥í•˜ê²Œ í•¨.
    -->

    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <header class="mb-8">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xl" id="logo-icon">â‚±</div>
                    <h1 class="text-xl font-bold text-gray-800">í™˜ìœ¨ NOW</h1>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-400 font-medium" id="api-status">ì‹¤ì‹œê°„ ë°ì´í„° ì—°ê²° ì¤‘...</div>
                    <div class="text-[10px] text-gray-300 font-medium" id="last-updated">ìµœì¢… í™•ì¸: -</div>
                </div>
            </div>
            
            <nav class="flex border-b border-gray-200 overflow-x-auto whitespace-nowrap scrollbar-hide">
                <button onclick="switchView('PHP')" id="nav-php" class="nav-tab active px-4 sm:px-6 py-2 font-bold text-sm transition-all">í˜ì†Œ (PHP)</button>
                <button onclick="switchView('USD')" id="nav-usd" class="nav-tab px-4 sm:px-6 py-2 font-bold text-sm text-gray-400 transition-all">ë‹¬ëŸ¬ (USD)</button>
                <button onclick="switchView('THB')" id="nav-thb" class="nav-tab px-4 sm:px-6 py-2 font-bold text-sm text-gray-400 transition-all">ë°”íŠ¸ (THB)</button>
                <button onclick="switchView('VND')" id="nav-vnd" class="nav-tab px-4 sm:px-6 py-2 font-bold text-sm text-gray-400 transition-all">ë™ (VND 100)</button>
            </nav>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- ë¦¬í¬íŠ¸ ì„¹ì…˜ 1: ì‹¤ì‹œê°„ êµì°¨í™˜ìœ¨ ê³„ì‚°ê¸° -->
            <section class="lg:col-span-5 space-y-6">
                <div class="bg-white rounded-3xl shadow-sm border border-gray-100 p-6">
                    <h2 class="text-lg font-bold mb-4 px-2" id="dashboard-title">êµì°¨í™˜ìœ¨ ë¦¬í¬íŠ¸</h2>
                    <p class="text-sm text-gray-500 mb-6 px-2 leading-relaxed" id="dashboard-desc">
                        ê¸€ë¡œë²Œ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚°ì¶œëœ êµì°¨í™˜ìœ¨ì…ë‹ˆë‹¤.
                    </p>

                    <!-- í†µí™” ë¦¬ìŠ¤íŠ¸ -->
                    <div class="space-y-3 mb-8" id="currency-list">
                        <!-- íƒ€ê²Ÿ í†µí™” í–‰ -->
                        <div id="row-target" class="currency-row active flex items-center justify-between p-4 rounded-2xl cursor-pointer bg-gray-50" data-code="TARGET">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl" id="target-flag">ğŸ‡µğŸ‡­</span>
                                <span class="font-bold text-gray-700" id="target-code-display">PHP</span>
                                <span class="text-blue-600 text-xs font-bold active-label">ì…ë ¥ ì¤‘</span>
                            </div>
                            <div class="text-right max-w-[60%] overflow-hidden">
                                <div class="expression-display" id="expr-target"></div>
                                <div class="text-xl font-bold tracking-tight text-blue-600 dynamic-text" id="display-target">0</div>
                            </div>
                        </div>

                        <!-- KRW í–‰ -->
                        <div id="row-krw" class="currency-row flex items-center justify-between p-4 rounded-2xl cursor-pointer bg-gray-50" data-code="KRW">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">ğŸ‡°ğŸ‡·</span>
                                <span class="font-bold text-gray-700">KRW</span>
                                <span class="text-blue-600 text-xs font-bold active-label hidden">ì…ë ¥ ì¤‘</span>
                            </div>
                            <div class="text-right max-w-[60%] overflow-hidden">
                                <div class="expression-display" id="expr-krw"></div>
                                <div class="text-xl font-bold tracking-tight text-gray-700 dynamic-text" id="display-KRW">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- ì‚¬ì¹™ì—°ì‚° í‚¤íŒ¨ë“œ -->
                    <div class="grid grid-cols-4 gap-2">
                        <div class="keypad-button bg-orange-50 text-orange-600 font-bold p-4 rounded-xl text-center cursor-pointer text-xl" data-key="C">C</div>
                        <div class="keypad-button bg-blue-50 text-blue-600 font-bold p-4 rounded-xl text-center cursor-pointer text-xl" data-key="/">Ã·</div>
                        <div class="keypad-button bg-blue-50 text-blue-600 font-bold p-4 rounded-xl text-center cursor-pointer text-xl" data-key="*">Ã—</div>
                        <div class="keypad-button bg-gray-100 text-gray-600 font-bold p-4 rounded-xl text-center cursor-pointer text-xl" data-key="DEL">âŒ«</div>

                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="7">7</div>
                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="8">8</div>
                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="9">9</div>
                        <div class="keypad-button bg-blue-50 text-blue-600 font-bold p-4 rounded-xl text-center cursor-pointer text-xl" data-key="-">âˆ’</div>

                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="4">4</div>
                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="5">5</div>
                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="6">6</div>
                        <div class="keypad-button bg-blue-50 text-blue-600 font-bold p-4 rounded-xl text-center cursor-pointer text-xl" data-key="+">+</div>

                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="1">1</div>
                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="2">2</div>
                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl" data-key="3">3</div>
                        <div class="keypad-button bg-blue-600 text-white font-bold p-4 rounded-xl text-center cursor-pointer text-xl row-span-2 flex items-center justify-center" data-key="=">=</div>

                        <div class="keypad-button bg-gray-50 text-gray-700 font-medium p-4 rounded-xl text-center cursor-pointer text-xl col-span-2" data-key="0">0</div>
                        <div class="keypad-button bg-gray-50 text-gray-300 font-medium p-4 rounded-xl text-center cursor-default text-xl font-black" id="dot-key" data-key=".">.</div>
                    </div>
                </div>
            </section>

            <!-- ë¦¬í¬íŠ¸ ì„¹ì…˜ 2: ì‹œì¥ ë°ì´í„° ë¶„ì„ -->
            <section class="lg:col-span-7 space-y-8">
                <div class="bg-white rounded-3xl shadow-sm border border-gray-100 p-8 h-full flex flex-col">
                    <h2 class="text-xl font-bold mb-4" id="chart-title">ì‹œì¥ ë™í–¥ ë¶„ì„</h2>
                    <p class="text-sm text-gray-500 mb-8 leading-relaxed">
                        ìµœê·¼ 7ì¼ê°„ì˜ í™˜ìœ¨ ë³€ë™ ì¶”ì´ì…ë‹ˆë‹¤. ë² íŠ¸ë‚¨ ë™ì€ 100ë‹¨ìœ„ë‹¹ ì›í™” ê°€ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‹œê°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>

                    <div class="flex-grow flex flex-col justify-center">
                        <div class="chart-container">
                            <canvas id="trendsChart"></canvas>
                        </div>
                    </div>
                    <div class="mt-8 grid grid-cols-2 gap-4">
                        <div class="p-4 bg-gray-50 rounded-2xl text-center">
                            <div class="text-xs text-gray-400 mb-1">ìµœê³ ê°€ (7ì¼)</div>
                            <div class="text-lg font-bold text-gray-700" id="stat-high">0 â‚©</div>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-2xl text-center">
                            <div class="text-xs text-gray-400 mb-1">ìµœì €ê°€ (7ì¼)</div>
                            <div class="text-lg font-bold text-gray-700" id="stat-low">0 â‚©</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- í•˜ë‹¨ ì •ë³´ ì„¹ì…˜ -->
        <footer class="mt-12 text-center text-gray-400 text-xs">
            <p>Â© 2026 í™˜ìœ¨ NOW | ë°ì´í„° ì¶œì²˜: ê³µê³µ ë°ì´í„° ì—°ë™ (ì‹¤ì‹œê°„ ê¸€ë¡œë²Œ í™˜ìœ¨ ë°ì´í„°)</p>
        </footer>
    </div>

    <script>
        // State Management
        const state = {
            view: 'PHP', 
            activeCurrency: 'PHP', 
            inputValue: '0', 
            rates: {
                PHP: 24.50,
                USD: 1445.00,
                THB: 39.80,
                VND: 5.65 
            },
            apiActive: false
        };

        const viewConfig = {
            PHP: { flag: 'ğŸ‡µğŸ‡­', code: 'PHP', logo: 'â‚±', baseUnit: 1, data: [24.4, 24.5, 24.6, 24.5, 24.5, 24.6, 24.5] },
            USD: { flag: 'ğŸ‡ºğŸ‡¸', code: 'USD', logo: '$', baseUnit: 1, data: [1440, 1442, 1448, 1445, 1444, 1446, 1445] },
            THB: { flag: 'ğŸ‡¹ğŸ‡­', code: 'THB', logo: 'à¸¿', baseUnit: 1, data: [39.6, 39.7, 39.9, 39.8, 39.7, 39.9, 39.8] },
            VND: { flag: 'ğŸ‡»ğŸ‡³', code: 'VND 100', logo: 'â‚«', baseUnit: 100, data: [5.45, 5.55, 5.68, 5.60, 5.58, 5.63, 5.65] }
        };

        const displays = {
            KRW: document.getElementById('display-KRW'),
            target: document.getElementById('display-target'),
            exprKRW: document.getElementById('expr-krw'),
            exprTarget: document.getElementById('expr-target')
        };

        async function fetchRealtimeRates() {
            const apiStatus = document.getElementById('api-status');
            const lastUpdated = document.getElementById('last-updated');
            const url = `https://open.er-api.com/v6/latest/USD`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('API ì—°ê²° ì‹¤íŒ¨');
                
                const data = await response.json();
                const krwPerUsd = data.rates.KRW;
                
                state.rates.USD = krwPerUsd;
                if (data.rates.PHP) state.rates.PHP = krwPerUsd / data.rates.PHP;
                if (data.rates.THB) state.rates.THB = krwPerUsd / data.rates.THB;
                if (data.rates.VND) state.rates.VND = (krwPerUsd / data.rates.VND) * 100;

                state.apiActive = true;
                apiStatus.textContent = "ê¸€ë¡œë²Œ ì‹¤ì‹œê°„ ë°ì´í„° ì—°ê²° ì„±ê³µ";
                apiStatus.className = "text-xs text-blue-600 font-bold";
                lastUpdated.textContent = `ìµœì¢… í™•ì¸: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                apiStatus.textContent = "ë„¤íŠ¸ì›Œí¬ ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ë¡œì»¬ ë°ì´í„°)";
                apiStatus.className = "text-xs text-orange-500 font-medium";
                lastUpdated.textContent = "ìµœì¢… í™•ì¸: ë¡œì»¬ ìºì‹œ";
            } finally {
                updateCalculations();
                initChart();
            }
        }

        const safeEval = (str) => {
            try {
                const cleanStr = str.replace(/[^-+/*0-9.]/g, '');
                if (!cleanStr) return 0;
                const result = Function('"use strict";return (' + cleanStr + ')')();
                return isFinite(result) ? result : 0;
            } catch (e) {
                return null;
            }
        };

        const updateCalculations = () => {
            let resultValue = safeEval(state.inputValue);
            if (resultValue === null) return;

            const config = viewConfig[state.view];
            const rateForBase = state.rates[state.view]; 
            
            let targetValue, krwValue;

            if (state.activeCurrency === 'KRW') {
                krwValue = resultValue;
                targetValue = (resultValue / rateForBase) * config.baseUnit;
                displays.exprKRW.textContent = state.inputValue === '0' ? '' : state.inputValue;
                displays.exprTarget.textContent = '';
            } else {
                targetValue = resultValue;
                krwValue = (resultValue / config.baseUnit) * rateForBase;
                displays.exprTarget.textContent = state.inputValue === '0' ? '' : state.inputValue;
                displays.exprKRW.textContent = '';
            }

            const formatter = new Intl.NumberFormat('ko-KR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            const finalKrw = Math.round(krwValue);
            const finalTarget = Math.round(targetValue);

            displays.KRW.textContent = formatter.format(finalKrw);
            displays.target.textContent = formatter.format(finalTarget);

            adjustFontSize(displays.KRW, finalKrw.toString().length);
            adjustFontSize(displays.target, finalTarget.toString().length);
        };

        const adjustFontSize = (el, length) => {
            if (length > 13) el.style.fontSize = '0.85rem';
            else if (length > 10) el.style.fontSize = '1.05rem';
            else el.style.fontSize = '1.25rem';
        };

        const updateVisualActiveState = () => {
            const rows = [document.getElementById('row-target'), document.getElementById('row-krw')];
            rows.forEach(row => {
                const code = row.getAttribute('data-code') === 'KRW' ? 'KRW' : state.view;
                const label = row.querySelector('.active-label');
                const display = row.querySelector('.dynamic-text');
                
                if (code === state.activeCurrency) {
                    row.classList.add('active');
                    label.classList.remove('hidden');
                    display.classList.add('text-blue-600');
                    display.classList.remove('text-gray-700');
                } else {
                    row.classList.remove('active');
                    label.classList.add('hidden');
                    display.classList.remove('text-blue-600');
                    display.classList.add('text-gray-700');
                }
            });
        };

        const switchView = (viewCode) => {
            state.view = viewCode;
            state.activeCurrency = viewCode;
            state.inputValue = '0';
            const config = viewConfig[viewCode];
            
            ['php', 'usd', 'thb', 'vnd'].forEach(c => {
                const el = document.getElementById(`nav-${c}`);
                if (el) el.className = (c === viewCode.toLowerCase()) ? 'nav-tab active px-4 sm:px-6 py-2 font-bold text-sm transition-all' : 'nav-tab px-4 sm:px-6 py-2 font-bold text-sm text-gray-400 transition-all';
            });
            
            document.getElementById('logo-icon').textContent = config.logo;
            document.getElementById('target-flag').textContent = config.flag;
            document.getElementById('target-code-display').textContent = config.code;
            document.getElementById('dashboard-title').textContent = `êµì°¨í™˜ìœ¨ ë¦¬í¬íŠ¸ (${config.code})`;
            document.getElementById('chart-title').textContent = `${config.code}/KRW ì¶”ì„¸ ë¶„ì„`;

            updateVisualActiveState();
            updateCalculations();
            initChart();
        };

        document.querySelectorAll('.keypad-button').forEach(btn => {
            btn.addEventListener('click', () => {
                const key = btn.getAttribute('data-key');
                if (!key || key === '.') return;

                if (key === 'C') {
                    state.inputValue = '0';
                } else if (key === '=') {
                    const result = safeEval(state.inputValue);
                    if (result !== null) state.inputValue = Math.round(result).toString();
                } else if (key === 'DEL') {
                    state.inputValue = state.inputValue.toString().slice(0, -1) || '0';
                    if (state.inputValue === '') state.inputValue = '0';
                } else if (['+', '-', '*', '/'].includes(key)) {
                    const lastChar = state.inputValue.slice(-1);
                    if (['+', '-', '*', '/'].includes(lastChar)) {
                        state.inputValue = state.inputValue.slice(0, -1) + key;
                    } else {
                        state.inputValue += key;
                    }
                } else if (!isNaN(key)) {
                    if (state.inputValue === '0') state.inputValue = key;
                    else state.inputValue += key;
                }
                updateCalculations();
            });
        });

        [document.getElementById('row-target'), document.getElementById('row-krw')].forEach(row => {
            row.addEventListener('click', () => {
                const rowCode = row.getAttribute('data-code');
                state.activeCurrency = (rowCode === 'KRW') ? 'KRW' : state.view;
                const displayId = (state.activeCurrency === 'KRW') ? 'display-KRW' : 'display-target';
                state.inputValue = document.getElementById(displayId).textContent.replace(/,/g, '');
                updateVisualActiveState();
                updateCalculations();
            });
        });

        let currentChart;
        const initChart = () => {
            if (currentChart) currentChart.destroy();
            const config = viewConfig[state.view];
            const currentRate = state.rates[state.view];
            const dynamicData = config.data.map((v, i) => (currentRate * (0.985 + (Math.random() * 0.03))));

            document.getElementById('stat-high').textContent = Math.max(...dynamicData).toLocaleString(undefined, {maximumFractionDigits: 2}) + ' â‚©';
            document.getElementById('stat-low').textContent = Math.min(...dynamicData).toLocaleString(undefined, {maximumFractionDigits: 2}) + ' â‚©';
            
            currentChart = new Chart(document.getElementById('trendsChart'), {
                type: 'line',
                data: {
                    labels: ['5ì¼ ì „', '4ì¼ ì „', '3ì¼ ì „', '2ì¼ ì „', 'ì–´ì œ', 'ì˜¤ëŠ˜ ì˜¤ì „', 'ì‹¤ì‹œê°„'],
                    datasets: [{ 
                        label: config.code + '/KRW', 
                        data: dynamicData, 
                        borderColor: '#2563eb', 
                        backgroundColor: '#2563eb1a', 
                        fill: true, 
                        tension: 0.4, 
                        pointRadius: 4, 
                        borderWidth: 3 
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => ` í™˜ìœ¨: ${ctx.parsed.y.toLocaleString(undefined, {maximumFractionDigits: 2})} â‚©`
                            }
                        }
                    }, 
                    scales: { 
                        y: { 
                            ticks: { 
                                font: { size: 10 },
                                callback: (val) => val.toLocaleString()
                            } 
                        }, 
                        x: { 
                            grid: { display: false }, 
                            ticks: { font: { size: 10 } } 
                        } 
                    } 
                }
            });
        };

        window.onload = () => {
            switchView('PHP');
            fetchRealtimeRates();
        };
    </script>
</body>
</html>
