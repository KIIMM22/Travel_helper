<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>환율계산기</title>
    
    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="환율계산기">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/263/263142.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        :root {
            --safe-top: env(safe-area-inset-top);
        }

        body {
            font-family: 'Noto+Sans+KR', -apple-system, sans-serif;
            background-color: #f1f5f9;
            -webkit-tap-highlight-color: transparent;
            padding-top: var(--safe-top);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* iOS-like Bounce Effect */
        .ios-active:active {
            transform: scale(0.96);
            transition: transform 0.1s ease;
        }
        
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-md glass-card rounded-[2.5rem] shadow-2xl overflow-hidden p-8 space-y-8">
        <!-- 상단 헤더 -->
        <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-900 tracking-tight">환율계산기</h1>
            <div id="statusIndicator" class="flex items-center justify-center space-x-2 mt-2">
                <span id="statusDot" class="w-2.5 h-2.5 rounded-full bg-yellow-400 animate-pulse"></span>
                <p id="statusText" class="text-sm text-gray-400 font-medium">환율 연결 중...</p>
            </div>
        </div>

        <!-- 메인 입력 -->
        <div class="space-y-4">
            <div class="flex justify-between items-end px-1">
                <label class="text-sm font-bold text-gray-500">대한민국 원 (KRW)</label>
            </div>
            
            <div class="relative group">
                <span class="absolute left-5 top-1/2 -translate-y-1/2 text-2xl font-bold text-gray-300">₩</span>
                <input type="number" id="krwInput" value="10000" step="1000" inputmode="numeric"
                    class="w-full pl-12 pr-6 py-6 bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white rounded-[1.5rem] text-3xl font-black text-blue-600 focus:outline-none transition-all shadow-inner"
                    placeholder="0">
            </div>
            
            <button id="convertBtn" class="w-full py-5 bg-blue-600 text-white text-lg font-bold rounded-[1.5rem] shadow-xl shadow-blue-200 ios-active">
                즉시 변환
            </button>
        </div>

        <!-- 결과 대시보드 -->
        <div id="resultsContainer" class="space-y-4">
            <!-- PHP -->
            <div class="bg-gradient-to-br from-indigo-600 to-blue-600 rounded-[1.5rem] p-6 text-white shadow-lg relative overflow-hidden">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-xs font-bold opacity-70 uppercase tracking-widest">PHILIPPINES (PHP)</span>
                    <span class="text-[10px] bg-black/20 px-2 py-1 rounded-md font-mono" id="phpRateInfo">1 ₩ = - ₱</span>
                </div>
                <div class="text-4xl font-black tracking-tight" id="resultPhp">₱0</div>
                <div class="absolute right-[-10px] bottom-[-10px] opacity-10">
                    <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg>
                </div>
            </div>

            <!-- USD -->
            <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-[1.5rem] p-6 text-white shadow-lg relative overflow-hidden">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-xs font-bold opacity-70 uppercase tracking-widest">UNITED STATES (USD)</span>
                    <span class="text-[10px] bg-black/20 px-2 py-1 rounded-md font-mono" id="usdRateInfo">1 ₩ = - $</span>
                </div>
                <div class="text-4xl font-black tracking-tight" id="resultUsd">$0.00</div>
                <div class="absolute right-[-10px] bottom-[-10px] opacity-10">
                    <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                </div>
            </div>
        </div>

        <!-- 하단 액션 -->
        <div class="pt-2 flex justify-between items-center text-gray-400">
            <button id="toggleEdit" class="text-xs font-medium hover:text-gray-600">환율 수동 설정</button>
            <p class="text-[10px]" id="updateTime">업데이트 대기 중</p>
        </div>

        <!-- 편집 영역 -->
        <div id="editArea" class="hidden animate-fade-in bg-gray-50 rounded-2xl p-4 space-y-3">
            <div class="grid grid-cols-2 gap-3">
                <input type="number" id="editKrw" placeholder="1$당 원화" class="p-3 text-sm border rounded-xl w-full">
                <input type="number" id="editPhp" placeholder="1$당 페소" class="p-3 text-sm border rounded-xl w-full">
            </div>
            <button id="saveRates" class="w-full py-3 bg-gray-800 text-white text-sm font-bold rounded-xl">설정 저장</button>
        </div>
    </div>

    <script>
        let rates = { "USD": 1, "KRW": 1390.0, "PHP": 58.5 };

        // DOM Elements
        const krwInput = document.getElementById('krwInput');
        const resultPhp = document.getElementById('resultPhp');
        const resultUsd = document.getElementById('resultUsd');
        const updateTime = document.getElementById('updateTime');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');

        async function initApp() {
            const saved = localStorage.getItem('travel_rates_v2');
            if (saved) rates = JSON.parse(saved);

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 4000);
                const response = await fetch('https://open.er-api.com/v6/latest/USD', { signal: controller.signal });
                clearTimeout(timeoutId);

                const data = await response.json();
                rates.KRW = data.rates.KRW;
                rates.PHP = data.rates.PHP;
                
                statusDot.className = "w-2.5 h-2.5 rounded-full bg-green-500";
                statusText.innerText = "환율 업데이트 완료";
                updateTime.innerText = new Date().toLocaleTimeString();
                localStorage.setItem('travel_rates_v2', JSON.stringify(rates));
            } catch (err) {
                statusDot.className = "w-2.5 h-2.5 rounded-full bg-red-400";
                statusText.innerText = "오프라인 모드 사용 중";
            } finally {
                calculate();
            }
        }

        function calculate() {
            const krw = parseFloat(krwInput.value) || 0;
            const usd = krw / rates.KRW;
            const php = (rates.PHP / rates.KRW) * krw;

            resultUsd.innerText = `$${usd.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            resultPhp.innerText = `₱${php.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
            
            document.getElementById('usdRateInfo').innerText = `1 ₩ = ${(1/rates.KRW).toFixed(6)} $`;
            document.getElementById('phpRateInfo').innerText = `1 ₩ = ${(rates.PHP/rates.KRW).toFixed(4)} ₱`;
        }

        // Event Listeners
        krwInput.addEventListener('input', calculate);
        document.getElementById('convertBtn').addEventListener('click', calculate);
        
        document.getElementById('toggleEdit').addEventListener('click', () => {
            document.getElementById('editArea').classList.toggle('hidden');
            document.getElementById('editKrw').value = rates.KRW;
            document.getElementById('editPhp').value = rates.PHP;
        });

        document.getElementById('saveRates').addEventListener('click', () => {
            rates.KRW = parseFloat(document.getElementById('editKrw').value);
            rates.PHP = parseFloat(document.getElementById('editPhp').value);
            localStorage.setItem('travel_rates_v2', JSON.stringify(rates));
            calculate();
            document.getElementById('editArea').classList.add('hidden');
        });

        initApp();
    </script>
</body>
</html>
